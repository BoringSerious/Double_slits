<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¢çš„å¹²æ¶‰éŠæˆ²</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        h1 {
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 1200px;
            width: 100%;
        }
        
        canvas {
            border: 3px solid #333;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
            background: #f0f0f0;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            align-items: center;
        }
        
        .left-controls, .right-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .control-group label {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }
        
        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-up {
            background: #4CAF50;
            color: white;
        }
        
        .btn-up:hover {
            background: #45a049;
        }
        
        .btn-down {
            background: #f44336;
            color: white;
        }
        
        .btn-down:hover {
            background: #da190b;
        }
        
        .btn-run {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            font-size: 18px;
        }
        
        .btn-run:hover {
            background: linear-gradient(135deg, #5568d3 0%, #654391 100%);
        }
        
        .btn-run:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .center-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .speed-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
        }
        
        .speed-control label {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        
        .speed-slider {
            width: 200px;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            -moz-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .speed-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .speed-value {
            font-size: 12px;
            color: #666;
            min-width: 40px;
            text-align: center;
        }
        
        .status {
            margin-top: 15px;
            text-align: center;
            color: #666;
            font-size: 14px;
        }
        
        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #1976D2;
        }
        
        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin: 5px 0;
            color: #555;
        }
    </style>
</head>
<body>
    <h1>ğŸŒŠ æ³¢çš„å¹²æ¶‰éŠæˆ² ğŸŒŠ</h1>
    <div class="container">
        <div class="instructions">
            <h3>ğŸ“– éŠæˆ²èªªæ˜</h3>
            <ul>
                <li>é¸æ“‡ç¹©å­å·¦ç«¯å’Œå³ç«¯çš„ç”©å‹•æ–¹å‘ï¼ˆå‘ä¸Šæˆ–å‘ä¸‹ï¼‰</li>
                <li>é»æ“Šã€Œé–‹å§‹ã€æŒ‰éˆ•ï¼Œå·¦å³å…©é‚Šæœƒå‘å„è‡ªé¸å®šçš„æ–¹å‘ç”©å‹•ä¸€æ¬¡</li>
                <li>æ¯å€‹ç”©å‹•æœƒç”¢ç”ŸåŠå€‹æ³¢å‹ï¼ˆå‘ä¸Šç”©ç”¢ç”Ÿä¸ŠåŠæ³¢ï¼Œå‘ä¸‹ç”©ç”¢ç”Ÿä¸‹åŠæ³¢ï¼‰</li>
                <li>ç•¶å…©å€‹åŠæ³¢å‚³éåˆ°ä¸­é–“ç›¸é‡æ™‚ï¼Œæœƒç™¼ç”Ÿå¹²æ¶‰ç¾è±¡ï¼š</li>
                <li style="margin-left: 20px;">â€¢ <strong style="color: #9C27B0;">ç´«è‰²</strong>ï¼šå»ºè¨­æ€§å¹²æ¶‰ï¼ˆå…©å€‹æ³¢åŒæ–¹å‘ï¼Œæ³¢ç›¸åŠ ï¼‰</li>
                <li style="margin-left: 20px;">â€¢ <strong style="color: #FF9800;">æ©™è‰²</strong>ï¼šç ´å£æ€§å¹²æ¶‰ï¼ˆå…©å€‹æ³¢åæ–¹å‘ï¼Œæ³¢æŠµæ¶ˆï¼‰</li>
                <li style="margin-left: 20px;">â€¢ <strong style="color: #2196F3;">è—è‰²</strong>ï¼šå–®å€‹æ³¢æˆ–æ­£å¸¸ç‹€æ…‹</li>
            </ul>
        </div>
        
        <canvas id="waveCanvas" width="1000" height="400"></canvas>
        
        <div class="controls">
            <div class="left-controls">
                <div class="control-group">
                    <label>å·¦ç«¯æ§åˆ¶</label>
                    <button class="btn-up" id="leftUp">â†‘ å‘ä¸Šç”©</button>
                    <button class="btn-down" id="leftDown">â†“ å‘ä¸‹ç”©</button>
                </div>
            </div>
            
            <div class="center-controls">
                <button class="btn-run" id="runBtn">é–‹å§‹</button>
                <div class="speed-control">
                    <label for="speedSlider">æ³¢å‚³æ’­é€Ÿåº¦</label>
                    <input type="range" id="speedSlider" class="speed-slider" min="1" max="10" value="3" step="0.5">
                    <span class="speed-value" id="speedValue">3.0</span>
                </div>
            </div>
            
            <div class="right-controls">
                <div class="control-group">
                    <label>å³ç«¯æ§åˆ¶</label>
                    <button class="btn-up" id="rightUp">â†‘ å‘ä¸Šç”©</button>
                    <button class="btn-down" id="rightDown">â†“ å‘ä¸‹ç”©</button>
                </div>
            </div>
        </div>
        
        <div class="status" id="status">è«‹é¸æ“‡å·¦å³å…©ç«¯çš„ç”©å‹•æ–¹å‘ï¼Œç„¶å¾Œé»æ“Šã€Œé–‹å§‹ã€</div>
    </div>

    <script>
        const canvas = document.getElementById('waveCanvas');
        const ctx = canvas.getContext('2d');
        
        // éŠæˆ²ç‹€æ…‹
        let leftDirection = null; // 1: å‘ä¸Š, -1: å‘ä¸‹
        let rightDirection = null;
        let isAnimating = true; // å§‹çµ‚é‹è¡Œå‹•ç•«
        let leftWaves = []; // å­˜å„²å¤šå€‹å·¦æ³¢
        let rightWaves = []; // å­˜å„²å¤šå€‹å³æ³¢
        let animationId = null;
        
        // ç¹©å­åƒæ•¸
        const ropeLength = 900;
        const ropeY = canvas.height / 2;
        const leftEnd = 50;
        const rightEnd = leftEnd + ropeLength;
        const numPoints = 200; // ç¹©å­ä¸Šçš„é»æ•¸
        
        // æ³¢çš„åƒæ•¸
        let waveSpeed = 3; // æ³¢çš„å‚³æ’­é€Ÿåº¦ï¼ˆå¯èª¿æ•´ï¼‰
        const waveAmplitude = 100; // æ³¢çš„æŒ¯å¹…
        const wavelength = 180; // æ³¢çš„æ³¢é•·
        
        // æŒ‰éˆ•äº‹ä»¶
        document.getElementById('leftUp').addEventListener('click', () => {
            leftDirection = 1;
            updateStatus();
            updateButtonStates();
            highlightButtons();
        });
        
        document.getElementById('leftDown').addEventListener('click', () => {
            leftDirection = -1;
            updateStatus();
            updateButtonStates();
            highlightButtons();
        });
        
        document.getElementById('rightUp').addEventListener('click', () => {
            rightDirection = 1;
            updateStatus();
            updateButtonStates();
            highlightButtons();
        });
        
        document.getElementById('rightDown').addEventListener('click', () => {
            rightDirection = -1;
            updateStatus();
            updateButtonStates();
            highlightButtons();
        });
        
        function highlightButtons() {
            // é‡ç½®æ‰€æœ‰æŒ‰é’®æ ·å¼
            document.getElementById('leftUp').style.opacity = '0.6';
            document.getElementById('leftDown').style.opacity = '0.6';
            document.getElementById('rightUp').style.opacity = '0.6';
            document.getElementById('rightDown').style.opacity = '0.6';
            
            // é«˜äº®é€‰ä¸­çš„æŒ‰é’®
            if (leftDirection === 1) {
                document.getElementById('leftUp').style.opacity = '1';
                document.getElementById('leftUp').style.transform = 'scale(1.1)';
                document.getElementById('leftDown').style.transform = 'scale(1)';
            } else if (leftDirection === -1) {
                document.getElementById('leftDown').style.opacity = '1';
                document.getElementById('leftDown').style.transform = 'scale(1.1)';
                document.getElementById('leftUp').style.transform = 'scale(1)';
            } else {
                document.getElementById('leftUp').style.transform = 'scale(1)';
                document.getElementById('leftDown').style.transform = 'scale(1)';
            }
            
            if (rightDirection === 1) {
                document.getElementById('rightUp').style.opacity = '1';
                document.getElementById('rightUp').style.transform = 'scale(1.1)';
                document.getElementById('rightDown').style.transform = 'scale(1)';
            } else if (rightDirection === -1) {
                document.getElementById('rightDown').style.opacity = '1';
                document.getElementById('rightDown').style.transform = 'scale(1.1)';
                document.getElementById('rightUp').style.transform = 'scale(1)';
            } else {
                document.getElementById('rightUp').style.transform = 'scale(1)';
                document.getElementById('rightDown').style.transform = 'scale(1)';
            }
        }
        
        document.getElementById('runBtn').addEventListener('click', () => {
            if (leftDirection !== null && rightDirection !== null) {
                startAnimation();
            }
        });
        
        // æ³¢é€Ÿåº¦æ»‘å—äº‹ä»¶ç›‘å¬å™¨
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        
        speedSlider.addEventListener('input', (e) => {
            waveSpeed = parseFloat(e.target.value);
            speedValue.textContent = waveSpeed.toFixed(1);
        });
        
        function updateStatus() {
            const statusEl = document.getElementById('status');
            let status = '';
            
            if (leftDirection === null && rightDirection === null) {
                status = 'è«‹é¸æ“‡å·¦å³å…©ç«¯çš„ç”©å‹•æ–¹å‘';
            } else if (leftDirection === null) {
                status = 'è«‹é¸æ“‡å·¦ç«¯çš„ç”©å‹•æ–¹å‘';
            } else if (rightDirection === null) {
                status = 'è«‹é¸æ“‡å³ç«¯çš„ç”©å‹•æ–¹å‘';
            } else {
                const leftDir = leftDirection === 1 ? 'å‘ä¸Š' : 'å‘ä¸‹';
                const rightDir = rightDirection === 1 ? 'å‘ä¸Š' : 'å‘ä¸‹';
                status = `å·¦ç«¯: ${leftDir} | å³ç«¯: ${rightDir} | é»æ“Šã€Œé–‹å§‹ã€è§€å¯Ÿå¹²æ¶‰ç¾è±¡`;
            }
            
            statusEl.textContent = status;
        }
        
        function updateButtonStates() {
            const runBtn = document.getElementById('runBtn');
            runBtn.disabled = leftDirection === null || rightDirection === null;
        }
        
        function resetGame() {
            leftDirection = null;
            rightDirection = null;
            leftWaves = [];
            rightWaves = [];
            updateStatus();
            updateButtonStates();
            highlightButtons();
            draw();
        }
        
        function startAnimation() {
            updateButtonStates();
            
            // æ·»åŠ æ–°çš„æ³¢ï¼ˆä¸é‡ç½®ç¾æœ‰çš„æ³¢ï¼‰
            if (leftDirection !== null) {
                leftWaves.push({
                    x: leftEnd,
                    direction: leftDirection,
                    time: 0
                });
            }
            
            if (rightDirection !== null) {
                rightWaves.push({
                    x: rightEnd,
                    direction: rightDirection,
                    time: 0
                });
            }
        }
        
        function animate() {
            // æ›´æ–°æ‰€æœ‰æ³¢çš„æ™‚é–“
            leftWaves.forEach(wave => wave.time++);
            rightWaves.forEach(wave => wave.time++);
            
            // ç§»é™¤å·²ç¶“å‚³æ’­å®Œç•¢çš„æ³¢
            const maxTime = ropeLength / waveSpeed * 2;
            leftWaves = leftWaves.filter(wave => wave.time <= maxTime);
            rightWaves = rightWaves.filter(wave => wave.time <= maxTime);
            
            draw();
            
            animationId = requestAnimationFrame(animate);
        }
        
        function draw() {
            // æ¸…é™¤ç•«å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç¹ªè£½èƒŒæ™¯ç¶²æ ¼ï¼ˆå¯é¸ï¼‰
            drawGrid();
            
            // è¨ˆç®—ç¹©å­çš„å½¢ç‹€
            const ropePoints = [];
            for (let i = 0; i <= numPoints; i++) {
                const x = leftEnd + (i / numPoints) * ropeLength;
                let y = ropeY;
                let leftWaveY = 0;
                let rightWaveY = 0;
                
                // è¨ˆç®—æ‰€æœ‰å·¦æ³¢çš„å½±éŸ¿ï¼ˆåªç”¢ç”ŸåŠå€‹æ³¢å‹ï¼‰
                for (const leftWave of leftWaves) {
                    const distanceFromLeft = x - leftEnd;
                    const waveDistance = leftWave.time * waveSpeed;
                    
                    if (distanceFromLeft >= 0 && distanceFromLeft <= waveDistance) {
                        const wavePosition = waveDistance - distanceFromLeft;
                        if (wavePosition <= wavelength) {
                            // åªç”ŸæˆåŠå€‹é€±æœŸï¼ˆ0 åˆ° Ï€ï¼‰ï¼Œé€™æ¨£åªæœƒç”¢ç”Ÿä¸€å€‹åŠæ³¢
                            const phase = (wavePosition / wavelength) * Math.PI;
                            // ä½¿ç”¨è¡°å‡å‡½æ•°ä½¿æ³¢é€æ¸æ¶ˆå¤±
                            const decay = Math.exp(-wavePosition / 150);
                            
                            // åªä¿ç•™åŠå€‹æ³¢å‹ï¼š
                            // å‘ä¸Šç”© (direction = 1)ï¼šåªä¿ç•™negativeéƒ¨åˆ†ï¼ˆyå‡å°ï¼Œç»³å­ä¸Šç§»ï¼‰
                            // å‘ä¸‹ç”© (direction = -1)ï¼šåªä¿ç•™positiveéƒ¨åˆ†ï¼ˆyå¢å¤§ï¼Œç»³å­ä¸‹ç§»ï¼‰
                            // ç¢ºä¿æŒ¯å¹…å°ç¨±ï¼šä½¿ç”¨çµ•å°å€¼è¨ˆç®—æŒ¯å¹…ï¼Œç„¶å¾Œæ ¹æ“šæ–¹å‘è³¦äºˆç¬¦è™Ÿ
                            const absAmplitude = Math.abs(Math.sin(phase)) * waveAmplitude * decay;
                            let amplitude;
                            if (leftWave.direction === 1) {
                                // å‘ä¸Šç”©ï¼šä½¿ç”¨è² å€¼ï¼ˆyæ¸›å°ï¼Œå‘ä¸Šï¼‰
                                amplitude = -absAmplitude;
                            } else {
                                // å‘ä¸‹ç”©ï¼šä½¿ç”¨æ­£å€¼ï¼ˆyå¢å¤§ï¼Œå‘ä¸‹ï¼‰
                                amplitude = absAmplitude;
                            }
                            
                            leftWaveY += amplitude;
                        }
                    }
                }
                
                // è¨ˆç®—æ‰€æœ‰å³æ³¢çš„å½±éŸ¿ï¼ˆåªç”¢ç”ŸåŠå€‹æ³¢å‹ï¼‰
                for (const rightWave of rightWaves) {
                    const distanceFromRight = rightEnd - x;
                    const waveDistance = rightWave.time * waveSpeed;
                    
                    if (distanceFromRight >= 0 && distanceFromRight <= waveDistance) {
                        const wavePosition = waveDistance - distanceFromRight;
                        if (wavePosition <= wavelength) {
                            // åªç”ŸæˆåŠå€‹é€±æœŸï¼ˆ0 åˆ° Ï€ï¼‰ï¼Œé€™æ¨£åªæœƒç”¢ç”Ÿä¸€å€‹åŠæ³¢
                            const phase = (wavePosition / wavelength) * Math.PI;
                            // ä½¿ç”¨è¡°å‡å‡½æ•°ä½¿æ³¢é€æ¸æ¶ˆå¤±
                            const decay = Math.exp(-wavePosition / 150);
                            
                            // åªä¿ç•™åŠå€‹æ³¢å‹ï¼š
                            // å‘ä¸Šç”© (direction = 1)ï¼šåªä¿ç•™negativeéƒ¨åˆ†ï¼ˆyå‡å°ï¼Œç»³å­ä¸Šç§»ï¼‰
                            // å‘ä¸‹ç”© (direction = -1)ï¼šåªä¿ç•™positiveéƒ¨åˆ†ï¼ˆyå¢å¤§ï¼Œç»³å­ä¸‹ç§»ï¼‰
                            // ç¢ºä¿æŒ¯å¹…å°ç¨±ï¼šä½¿ç”¨çµ•å°å€¼è¨ˆç®—æŒ¯å¹…ï¼Œç„¶å¾Œæ ¹æ“šæ–¹å‘è³¦äºˆç¬¦è™Ÿ
                            const absAmplitude = Math.abs(Math.sin(phase)) * waveAmplitude * decay;
                            let amplitude;
                            if (rightWave.direction === 1) {
                                // å‘ä¸Šç”©ï¼šä½¿ç”¨è² å€¼ï¼ˆyæ¸›å°ï¼Œå‘ä¸Šï¼‰
                                amplitude = -absAmplitude;
                            } else {
                                // å‘ä¸‹ç”©ï¼šä½¿ç”¨æ­£å€¼ï¼ˆyå¢å¤§ï¼Œå‘ä¸‹ï¼‰
                                amplitude = absAmplitude;
                            }
                            
                            rightWaveY += amplitude;
                        }
                    }
                }
                
                // æ‰€æœ‰æ³¢ç–ŠåŠ ï¼ˆå¹²æ¶‰ï¼‰
                y = ropeY + leftWaveY + rightWaveY;
                
                ropePoints.push({ x, y });
            }
            
            // ç¹ªè£½ç¹©å­ï¼ˆæ ¹æ“šå¹²æ¶‰å¼·åº¦æ”¹è®Šé¡è‰²ï¼‰
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            // ç¹ªè£½ç¹©å­ä¸»é«”ï¼Œæ ¹æ“šä½ç½®æ±ºå®šé¡è‰²
            for (let i = 0; i < ropePoints.length - 1; i++) {
                const p1 = ropePoints[i];
                const p2 = ropePoints[i + 1];
                const x = (p1.x + p2.x) / 2;
                
                // è¨ˆç®—æ­¤ä½ç½®çš„æ³¢å¼·åº¦ï¼ˆç”¨æ–¼æ±ºå®šé¡è‰²ï¼‰
                let totalAmplitude = 0;
                let leftAmplitude = 0;
                let rightAmplitude = 0;
                let hasLeftWave = false;
                let hasRightWave = false;
                
                // è¨ˆç®—æ‰€æœ‰å·¦æ³¢çš„å½±éŸ¿
                for (const leftWave of leftWaves) {
                    const distFromLeft = x - leftEnd;
                    const waveDist = leftWave.time * waveSpeed;
                    if (distFromLeft >= 0 && distFromLeft <= waveDist) {
                        const wavePos = waveDist - distFromLeft;
                        if (wavePos <= wavelength) {
                            // åªç”ŸæˆåŠå€‹é€±æœŸï¼ˆ0 åˆ° Ï€ï¼‰ï¼Œé€™æ¨£åªæœƒç”¢ç”Ÿä¸€å€‹åŠæ³¢
                            const phase = (wavePos / wavelength) * Math.PI;
                            const decay = Math.exp(-wavePos / 150);
                            // ä½¿ç”¨çµ•å°å€¼ç¢ºä¿æŒ¯å¹…å°ç¨±
                            const absAmp = Math.abs(Math.sin(phase)) * decay;
                            let amp;
                            if (leftWave.direction === 1) {
                                // å‘ä¸Šç”©ï¼šä½¿ç”¨è² å€¼ï¼ˆyæ¸›å°ï¼Œå‘ä¸Šï¼‰
                                amp = -absAmp;
                            } else {
                                // å‘ä¸‹ç”©ï¼šä½¿ç”¨æ­£å€¼ï¼ˆyå¢å¤§ï¼Œå‘ä¸‹ï¼‰
                                amp = absAmp;
                            }
                            if (Math.abs(amp) > 0.01) {
                                const waveAmp = amp * waveAmplitude;
                                leftAmplitude += waveAmp;
                                totalAmplitude += Math.abs(waveAmp);
                                hasLeftWave = true;
                            }
                        }
                    }
                }
                
                // è¨ˆç®—æ‰€æœ‰å³æ³¢çš„å½±éŸ¿
                for (const rightWave of rightWaves) {
                    const distFromRight = rightEnd - x;
                    const waveDist = rightWave.time * waveSpeed;
                    if (distFromRight >= 0 && distFromRight <= waveDist) {
                        const wavePos = waveDist - distFromRight;
                        if (wavePos <= wavelength) {
                            // åªç”ŸæˆåŠå€‹é€±æœŸï¼ˆ0 åˆ° Ï€ï¼‰ï¼Œé€™æ¨£åªæœƒç”¢ç”Ÿä¸€å€‹åŠæ³¢
                            const phase = (wavePos / wavelength) * Math.PI;
                            const decay = Math.exp(-wavePos / 150);
                            // ä½¿ç”¨çµ•å°å€¼ç¢ºä¿æŒ¯å¹…å°ç¨±
                            const absAmp = Math.abs(Math.sin(phase)) * decay;
                            let amp;
                            if (rightWave.direction === 1) {
                                // å‘ä¸Šç”©ï¼šä½¿ç”¨è² å€¼ï¼ˆyæ¸›å°ï¼Œå‘ä¸Šï¼‰
                                amp = -absAmp;
                            } else {
                                // å‘ä¸‹ç”©ï¼šä½¿ç”¨æ­£å€¼ï¼ˆyå¢å¤§ï¼Œå‘ä¸‹ï¼‰
                                amp = absAmp;
                            }
                            if (Math.abs(amp) > 0.01) {
                                const waveAmp = amp * waveAmplitude;
                                rightAmplitude += waveAmp;
                                totalAmplitude += Math.abs(waveAmp);
                                hasRightWave = true;
                            }
                        }
                    }
                }
                
                // å¦‚æœå…©å€‹æ³¢éƒ½åœ¨æ­¤ä½ç½®ï¼Œé¡¯ç¤ºå¹²æ¶‰é¡è‰²
                const isInterference = hasLeftWave && hasRightWave;
                
                if (isInterference) {
                    // åˆ¤æ–·å…©å€‹åŠæ³¢çš„æ–¹å‘æ˜¯å¦ç›¸åŒ
                    const sameDirection = (leftAmplitude >= 0 && rightAmplitude >= 0) || 
                                        (leftAmplitude <= 0 && rightAmplitude <= 0);
                    
                    // è¨ˆç®—ç–ŠåŠ å¾Œçš„æŒ¯å¹…
                    const combinedAmplitude = Math.abs(leftAmplitude + rightAmplitude);
                    const individualAmplitude = Math.abs(leftAmplitude) + Math.abs(rightAmplitude);
                    
                    if (sameDirection && combinedAmplitude > individualAmplitude * 0.5) {
                        // å»ºè¨­æ€§å¹²æ¶‰ï¼ˆå…©å€‹åŠæ³¢åŒæ–¹å‘ï¼Œæ³¢ç›¸åŠ ï¼‰- ç´«è‰²
                        ctx.strokeStyle = '#9C27B0';
                    } else if (!sameDirection && combinedAmplitude < individualAmplitude * 0.5) {
                        // ç ´å£æ€§å¹²æ¶‰ï¼ˆå…©å€‹åŠæ³¢åæ–¹å‘ï¼Œæ³¢æŠµæ¶ˆï¼‰- æ©™è‰²
                        ctx.strokeStyle = '#FF9800';
                    } else {
                        // æ­£å¸¸æ³¢ - è—è‰²
                        ctx.strokeStyle = '#2196F3';
                    }
                } else {
                    // æ­£å¸¸æ³¢ - è—è‰²
                    ctx.strokeStyle = '#2196F3';
                }
                
                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
                ctx.stroke();
            }
            
            // ç¹ªè£½ç¹©å­ç«¯é»
            ctx.fillStyle = '#1976D2';
            ctx.beginPath();
            ctx.arc(leftEnd, ropeY, 8, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(rightEnd, ropeY, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // ç¹ªè£½ç¹©å­ä¸­å¿ƒé»ï¼ˆç´…è‰²å°é»ï¼Œéš¨éœ‡å‹•å‚ç›´ç§»å‹•ï¼‰
            const centerX = (leftEnd + rightEnd) / 2;
            // è¨ˆç®—ä¸­å¿ƒä½ç½®çš„yåæ¨™ï¼ˆè€ƒæ…®æ‰€æœ‰æ³¢çš„å½±éŸ¿ï¼‰
            let centerY = ropeY;
            let centerLeftWaveY = 0;
            let centerRightWaveY = 0;
            
            // è¨ˆç®—æ‰€æœ‰å·¦æ³¢åœ¨ä¸­å¿ƒä½ç½®çš„å½±éŸ¿
            for (const leftWave of leftWaves) {
                const distanceFromLeft = centerX - leftEnd;
                const waveDistance = leftWave.time * waveSpeed;
                if (distanceFromLeft >= 0 && distanceFromLeft <= waveDistance) {
                    const wavePosition = waveDistance - distanceFromLeft;
                    if (wavePosition <= wavelength) {
                        const phase = (wavePosition / wavelength) * Math.PI;
                        const decay = Math.exp(-wavePosition / 150);
                        const absAmplitude = Math.abs(Math.sin(phase)) * waveAmplitude * decay;
                        if (leftWave.direction === 1) {
                            centerLeftWaveY -= absAmplitude;
                        } else {
                            centerLeftWaveY += absAmplitude;
                        }
                    }
                }
            }
            
            // è¨ˆç®—æ‰€æœ‰å³æ³¢åœ¨ä¸­å¿ƒä½ç½®çš„å½±éŸ¿
            for (const rightWave of rightWaves) {
                const distanceFromRight = rightEnd - centerX;
                const waveDistance = rightWave.time * waveSpeed;
                if (distanceFromRight >= 0 && distanceFromRight <= waveDistance) {
                    const wavePosition = waveDistance - distanceFromRight;
                    if (wavePosition <= wavelength) {
                        const phase = (wavePosition / wavelength) * Math.PI;
                        const decay = Math.exp(-wavePosition / 150);
                        const absAmplitude = Math.abs(Math.sin(phase)) * waveAmplitude * decay;
                        if (rightWave.direction === 1) {
                            centerRightWaveY -= absAmplitude;
                        } else {
                            centerRightWaveY += absAmplitude;
                        }
                    }
                }
            }
            
            // è¨ˆç®—ä¸­å¿ƒé»çš„å¯¦éš›yåæ¨™ï¼ˆæ‰€æœ‰æ³¢ç–ŠåŠ ï¼‰
            centerY = ropeY + centerLeftWaveY + centerRightWaveY;
            
            ctx.fillStyle = '#f44336';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 6, 0, Math.PI * 2);
            ctx.fill();
            
        }
        
        function drawGrid() {
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            
            // ç¹ªè£½æ°´å¹³ç¶²æ ¼ç·š
            for (let y = 50; y < canvas.height; y += 50) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // ç¹ªè£½ä¸­å¿ƒç·šï¼ˆç¹©å­ä½ç½®ï¼‰
            ctx.strokeStyle = '#999';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, ropeY);
            ctx.lineTo(canvas.width, ropeY);
            ctx.stroke();
            ctx.setLineDash([]);
        }
        
        // åˆå§‹åŒ–
        updateStatus();
        updateButtonStates();
        draw();
        animate(); // å•Ÿå‹•å‹•ç•«å¾ªç’°
    </script>
</body>
</html>

